<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header">
</head>
<body>
<nav th:replace="fragments/nav :: nav"></nav>
<div class="container">
    <div style="height: 60px;"></div>
    <h1>新增记录</h1>
    <form id="new-bill-form" class="form-horizontal" th:action="@{/bill/add}" method="post"
          data-bv-feedbackicons-valid="glyphicon glyphicon-ok"
          data-bv-feedbackicons-invalid="glyphicon glyphicon-remove"
          data-bv-feedbackicons-validating="glyphicon glyphicon-refresh">
        <div class="form-group">
            <label class="col-sm-2 control-label">收支</label>
            <div class="col-sm-10">
                <label class="radio-inline">
                    <!--/*@thymesVar id="Type" type="loveinliuy.bill.model.Bill.Type"*/-->
                    <input type="radio" name="type" id="type-out" th:value="${T(loveinliuy.bill.model.Bill.Type).Expense.name()}" checked="checked"/>支出
                </label>
                <label class="radio-inline">
                    <input type="radio" name="type" id="type-in" th:value="${T(loveinliuy.bill.model.Bill.Type).Income.name()}"/>收入
                </label>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label" for="date">日期</label>
            <div class="col-sm-10">
                <div class="input-group date">
                    <div class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </div>
                    <input type="text" class="form-control" id="date" name="date" value="2015-01-01" placeholder="啥时候"
                           th:value="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}"
                           data-bv-notempty="true"
                           data-bv-notempty-message="还没选啥时候花的呢"/>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label" for="description">描述</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" name="description" id="description" placeholder="哪儿花的"
                       data-bv-notempty="true"
                       data-bv-notempty-message="这钱到底花哪儿了啊"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label" for="cost">金额</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" name="cost" id="cost" placeholder="花多钱"
                       data-bv-notempty="true"
                       data-bv-notempty-message="花了多钱啊"
                       data-bv-regexp="true"
                       data-bv-regexp-regexp="^(([1-9]\d{0,9})|0)(\.\d{1,2})?$"
                       data-bv-regexp-message="填正确的金额"
                       data-bv-greaterthan="true"
                       data-bv-greaterthan-inclusive="false"
                       data-bv-greaterthan-value="0.00"
                       data-bv-greaterthan-message="你填这钱没大于0啊"/>
            </div>
        </div>
        <div class="form-group">
            <div class="row col-sm-offset-2 col-sm-10">
                <div class="col-sm-4 pull-right">
                    <button type="submit" class="btn btn-default">提交</button>
                    <a role="button" th:href="@{/index}" class="btn btn-default">取消</a>
                </div>
            </div>
        </div>
    </form>
</div>

<div th:replace="fragments/footer :: common-js"></div>
<script th:inline="javascript" type="text/javascript">
    /*<![CDATA[*/
    $(function () {
        $('#new-bill-form').bootstrapValidator({
            fields: {
                description: {
                    validators: {
                        remote: {
                            url: /*[[@{/bill/description/validate}]]*/ '/bill/description/validate',
                            data: function (validator, $field, value) {
                                return {
                                    date: validator.getFieldElements('date').val(),
                                    description: value
                                };
                            },
                            type: "GET",
                            delay: 1000,
                            message: '今天已经写过一个了'
                        }
                    }
                }
            }
        });
        $('input[type=radio][name=type]').click(function () {
            var $this = $(this);
            if ($this.val() === 'Income') {
                $('input[name=description]').attr('placeholder', '哪儿来的');
                $('input[name=cost]').attr('placeholder', '来多钱');
            } else {
                $('input[name=description]').attr('placeholder', '哪儿花的');
                $('input[name=cost]').attr('placeholder', '花多钱');
            }
        });
        $('.date').datepicker({
            language: 'zh-CN',
            format: 'yyyy-mm-dd'
        }).on('hide', function () {
            $('#new-bill-form').data('bootstrapValidator')
                .revalidateField('date');
        }).on('changeDate', function () {
            $('.date').datepicker('hide');
        });
    });
    /*]]>*/
</script>
</body>
</html>
